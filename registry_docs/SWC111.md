# 使用已弃用的 Solidity 函数

#### Relationships
[CWE-477：使用过时的功能](https://cwe.mitre.org/data/definitions/477.html)

#### Description
Solidity 中的一些functions and operators已被弃用。 使用它们会导致代码质量下降。 使用 Solidity 编译器的新主要版本，不推荐使用的functions and operators可能会导致副作用和编译错误。

#### Remediation
Solidity 为已弃用的结构提供了替代方案。 它们中的大多数是别名，因此替换旧结构不会破坏当前行为。 例如，`sha3` 可以替换为 `keccak256`。

| Deprecated | Col2 |
| --- | --- |
| `suicide(address)` | `selfdestruct(address)` |
| `block.blockhash(uint)` | `blockhash(uint)` |
| `sha3(...)` | `keccak256(...)` |
| `callcode(...)` | `delegatecall(...)` |
| `throw` | `revert()` |
| `msg.gas` | `gasleft` |
| `constant` | `view` |
| `var` | 使用对应类型名称替代（int,byte* string, address等等） |

#### References
- [List of global variables and functions, as of Solidity 0.4.25](https://solidity.readthedocs.io/en/v0.4.25/miscellaneous.html#global-variables)
- [Error handling: Assert, Require, Revert and Exceptions](https://solidity.readthedocs.io/en/v0.4.25/control-structures.html#error-handling-assert-require-revert-and-exceptions)
- [View functions](https://solidity.readthedocs.io/en/v0.4.25/contracts.html#view-functions)
- [Untyped declaration is deprecated as of Solidity 0.4.20](https://github.com/ethereum/solidity/releases/tag/v0.4.20)
- [Solidity compiler changelog](https://github.com/ethereum/solidity/releases)
  
#### Contract Samples
##### deprecated_simple.sol
```
pragma solidity ^0.4.24;

contract DeprecatedSimple {

    // Do everything that's deprecated, then commit suicide.

    function useDeprecated() public constant {

        bytes32 blockhash = block.blockhash(0);
        bytes32 hashofhash = sha3(blockhash);

        uint gas = msg.gas;

        if (gas == 0) {
            throw;
        }

        address(this).callcode();

        var a = [1,2,3];

        var (x, y, z) = (false, "test", 0);

        suicide(address(0));
    }

    function () public {}

}
```
问题描述：
使用不推荐使用的函数、别名和关键字

解决方案：
```
pragma solidity ^0.4.24;

contract DeprecatedSimpleFixed {

    function useDeprecatedFixed() public view {

        bytes32 bhash = blockhash(0);
        bytes32 hashofhash = keccak256(bhash);

        uint gas = gasleft();

        if (gas == 0) {
            revert();
        }

        address(this).delegatecall();

        uint8[3] memory a = [1,2,3];

        (bool x, string memory y, uint8 z) = (false, "test", 0);

        selfdestruct(address(0));
    }

    function () external {}

}
```